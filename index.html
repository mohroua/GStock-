<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ุฅุฏุงุฑุฉ ุงููุฎุฒูู ูุน ููุญุฉ ุชุญูู ูุชูุฏูุฉ</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2196f3">
  <link rel="icon="icons/401751295234.png">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <scripthttps://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js src=""></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>๐ฆ ุฅุฏุงุฑุฉ ุงููุฎุฒูู</h1>
  <nav>
    <button onclick="showSection('dashboard')">ุงูุฑุฆูุณูุฉ</button>
    <button onclick="showSection('products')">ุงูููุชุฌุงุช</button>
    <button onclick="showSection('sales')">ุงููุจูุนุงุช</button>
    <button onclick="showSection('inventory')">ุงูุฌุฑุฏ</button>
  </nav>

  <section id="dashboard" class="section active">
    <h2>๐ ููุญุฉ ุงูุชุญูู</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <h3>ุฅุฌูุงูู ูููุฉ ุงููุฎุฒูู</h3>
        <p><span id="dashboardTotalInventoryValue">0</span> ุฏุฌ</p>
      </div>
      <div class="stat-card">
        <h3>ุนุฏุฏ ุงูููุชุฌุงุช ุงููุฑูุฏุฉ</h3>
        <p><span id="dashboardTotalProducts">0</span> ููุชุฌ</p>
      </div>
      <div class="stat-card low-stock-items">
        <h3>๐จ ุงูููุชุฌุงุช ููุฎูุถุฉ ุงููุฎุฒูู</h3>
        <ul id="dashboardLowStockList">
          <li>ูุง ุชูุฌุฏ ููุชุฌุงุช ููุฎูุถุฉ ุงููุฎุฒูู ุญุงููุงู.</li>
        </ul>
      </div>
      <div class="stat-card">
        <h3>ูุจูุนุงุช ุงูููู</h3>
        <p><span id="dashboardDailySales">0</span> ุฏุฌ</p>
      </div>
      <div class="stat-card">
        <h3>ูุจูุนุงุช ุงูุฃุณุจูุน</h3>
        <p><span id="dashboardWeeklySales">0</span> ุฏุฌ</p>
      </div>
    </div>
  </section>

  <section id="products" class="section">
    <h2>โ ุฅุถุงูุฉ / ุชุนุฏูู ููุชุฌ</h2>
    <input type="text" id="productCode" placeholder="๐ ููุฏ ุงูููุชุฌ (ุงุฎุชูุงุฑู ุฃู ุงูุณุญ)">
    <button class="scan-btn" onclick="startProductScanner()">๐ฅ๏ธ ุงูุณุญ ุจุงุฑููุฏ ุงูููุชุฌ</button>
    <div id="productReader" style="width:300px; margin:auto;"></div>
    <input type="text" id="productName" placeholder="ุงุณู ุงูููุชุฌ">
    <input type="text" id="productCategory" placeholder="ุงููุฆุฉ (ูุซุงู: ุฅููุชุฑูููุงุชุ ุทุนุงูุ ููุงุจุณ)">

    <label for="productQty">ุงููููุฉ:</label> <input type="number" list="productQuantityOptions" id="productQty" name="productQty" placeholder="ุงุฎุชุฑ ุฃู ุงูุชุจ ุงููููุฉ" min="1">
    <datalist id="productQuantityOptions"> <option value="1">
      <option value="2">
      <option value="3">
      <option value="4">
      <option value="5">
      <option value="6">
      <option value="7">
      <option value="8">
      <option value="9">
      <option value="10">
      </datalist>

    <label for="unitType">ููุน ุงููุญุฏุฉ:</label>
    <select id="unitType">
      <option value="ูุทุนุฉ">ูุทุนุฉ</option>
      <option value="ูุบ">ูุบ</option>
      <option value="ูุชุฑ">ูุชุฑ</option>
      <option value="ุนูุจุฉ">ุนูุจุฉ</option>
      <option value="ูุชุฑ">ูุชุฑ</option>
    </select>

    <input type="number" id="productPrice" placeholder="ุงูุณุนุฑ">
    <button class="add-btn" onclick="addProduct()">ุฅุถุงูุฉ / ุชุญุฏูุซ ุงูููุชุฌ</button>

    <hr>
    <h3>ุฅุถุงูุฉ ูููุฉ ูููุชุฌ ููุฌูุฏ (ุฃูุฑ ุดุฑุงุก)</h3>
    <input type="text" id="addStockProductCode" placeholder="ููุฏ ุงูููุชุฌ ูุฅุถุงูุฉ ูููุฉ">
    <input type="number" id="addStockQuantity" placeholder="ุงููููุฉ ุงููุฑุงุฏ ุฅุถุงูุชูุง">
    <button class="primary-btn" onclick="addQuantityToProduct()">โ ุฅุถุงูุฉ ูููุฉ</button>
    
    <h2>ูุงุฆูุฉ ุงูููุชุฌุงุช</h2>
    <div class="filter-controls">
        <input type="text" id="productSearch" placeholder="ุงุจุญุซ ุจุงูุงุณู ุฃู ุงูููุฏ" oninput="updateProductTable()">
        <select id="productCategoryFilter" onchange="updateProductTable()">
            <option value="">ุฌููุน ุงููุฆุงุช</option>
        </select>
        <button class="primary-btn" onclick="updateProductTable()" style="width: auto; margin: 0;">ุชุญุฏูุซ ุงููุงุฆูุฉ</button>
    </div>

    <table>
      <thead><tr><th>ุงูุจุงุฑููุฏ</th><th>ุงูุงุณู</th><th>ุงููุฆุฉ</th><th>ุงููููุฉ</th><th>ุงูุณุนุฑ</th><th>ุฑูุฒ</th><th>ุงูุฅุฌุฑุงุกุงุช</th></tr></thead>
      <tbody id="productTable"></tbody>
    </table>
  </section>

  <section id="sales" class="section">
    <h2>๐ ุงูุจูุน</h2>
    <input type="text" id="saleCode" placeholder="๐ ููุฏ ุฃู ุงุณู ุงูููุชุฌ" list="productSuggestions" oninput="updateSuggestions()">
    <datalist id="productSuggestions"></datalist>

   <label for="saleQuantity">ุงููููุฉ:</label>
   <input type="number" list="quantityOptions" id="saleQuantity" name="saleQuantity" placeholder="ุงุฎุชุฑ ุฃู ุงูุชุจ ุงููููุฉ" min="1">
   <datalist id="quantityOptions"> <option value="1">
     <option value="2">
     <option value="3">
     <option value="4">
     <option value="5">
     <option value="6">
     <option value="7">
     <option value="8">
     <option value="9">
     <option value="10">
   </datalist>


   <button class="add-btn" onclick="addToCart()">ุฅุถุงูุฉ ููุณูุฉ</button>
    <div id="reader" style="width:300px; margin:auto;"></div>
    <button id="scanBtn" class="scan-btn" onclick="startSaleScanner()">๐ฅ๏ธ ุงูุณุญ ุงูุจุงุฑููุฏ ุจุงููุงููุฑุง (ุงุฎุชูุงุฑู)</button>
    <button id="cancelScanBtn" class="cancel-btn" onclick="cancelSaleScanner()" style="display:none;">โ ุฅูุบุงุก ุงููุณุญ</button>
    <table>
      <thead><tr><th>ุงูููุชุฌ</th><th>ุงููููุฉ</th><th>ุงูุณุนุฑ</th><th>ุงููุฌููุน</th><th>ุญุฐู</th></tr></thead>
      <tbody id="cartTable"></tbody>
    </table>
    <p>๐งพ ุงููุฌููุน ุงูููู: <span id="cartTotal">0</span> ุฏุฌ</p>
    <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
        <button class="confirm-btn" style="width: 180px;" onclick="confirmSale()">ุชุฃููุฏ ุงูุจูุน</button>
        <button class="cancel-btn" style="width: 180px; background-color: #f44336;" onclick="undoLastSale()">โฉ๏ธ ุชุฑุงุฌุน ุนู ุขุฎุฑ ุจูุน</button>
    </div>
  </section>

  <section id="inventory" class="section">
    <h2>๐ ุงููุฎุฒูู ุงูุญุงูู</h2>
    <div class="filter-controls">
        <input type="text" id="inventorySearch" placeholder="ุงุจุญุซ ุนู ููุชุฌ ุจุงูุงุณู ุฃู ุงูููุฏ" oninput="showInventory()">
        <select id="inventoryCategoryFilter" onchange="showInventory()">
            <option value="">ุฌููุน ุงููุฆุงุช</option>
            </select>
        <button class="primary-btn" onclick="showInventory()">ุนุฑุถ/ุชุญุฏูุซ ุงููุฎุฒูู</button>

        <div style="position: relative; display: inline-block;">
            <button onclick="toggleExportMenu('inventory')" class="export-btn" style="display: inline-block; width: auto; margin: 0;">
                ุชุตุฏูุฑ ุงููุฎุฒูู โฌ๏ธ
            </button>
            <div id="inventoryExportMenu" class="export-menu">
                <a href="#" onclick="exportInventory('pdf'); hideExportMenus();">PDF</a>
                <a href="#" onclick="exportInventory('csv'); hideExportMenus();">CSV</a>
            </div>
        </div>
    </div>
    
    <div id="inventoryDisplay">
        <table>
            <thead>
                <tr>
                    <th onclick="sortInventory('code')">ููุฏ ุงูููุชุฌ <span id="sort-code"></span></th>
                    <th onclick="sortInventory('name')">ุงุณู ุงูููุชุฌ <span id="sort-name"></span></th>
                    <th onclick="sortInventory('category')">ุงููุฆุฉ <span id="sort-category"></span></th>
                    <th onclick="sortInventory('qty')">ุงููููุฉ ุงููุชููุฑุฉ <span id="sort-qty"></span></th>
                    <th onclick="sortInventory('price')">ุณุนุฑ ุงูุจูุน <span id="sort-price"></span></th>
                    <th>ุฅุฌูุงูู ูููุฉ ุงููุฎุฒูู <span id="sort-total-value"></span></th>
                    <th>ุญุงูุฉ ุงููุฎุฒูู</th>
                </tr>
            </thead>
            <tbody id="inventoryTableBody"></tbody>
        </table>
        <p>๐ ุฅุฌูุงูู ูููุฉ ุงููุฎุฒูู ุงููููุฉ: <span id="totalInventoryValue">0</span> ุฏุฌ</p>
    </div>
    
    <hr> <h2>๐ ุณุฌู ุงููุจูุนุงุช (ุงูููุงุชูุฑ)</h2>
    <div class="filter-controls">
        <input type="date" id="startDate" title="ุชุงุฑูุฎ ุงูุจุฏุก">
        <input type="date" id="endDate" title="ุชุงุฑูุฎ ุงูุงูุชูุงุก">
        <button class="primary-btn" onclick="applyDateFilter()" style="width: auto; margin: 0;">ุชุตููุฉ ุญุณุจ ุงูุชุงุฑูุฎ</button>
        <button class="primary-btn" onclick="resetSalesFilters()" style="background-color: #607d8b; width: auto; margin: 0;">ุฅุนุงุฏุฉ ุชุนููู ุงูููุงุชุฑ</button>

        <div style="position: relative; display: inline-block;">
            <button onclick="toggleExportMenu('sales')" class="export-btn" style="display: inline-block; width: auto; margin: 0;">
                ุชุตุฏูุฑ ุงูููุงุชูุฑ โฌ๏ธ
            </button>
            <div id="salesExportMenu" class="export-menu">
                <a href="#" onclick="exportSalesHistory('pdf'); hideExportMenus();">PDF</a>
                <a href="#" onclick="exportSalesHistory('csv'); hideExportMenus();">CSV</a>
            </div>
        </div>
    </div>
    
    <button class="primary-btn" onclick="showSalesHistory()">ุนุฑุถ ุฌููุน ุงูููุงุชูุฑ</button>

    <div id="salesHistoryContainer" class="section">
        <table>
            <thead>
                <tr>
                    <th>ุฑูู ุงููุงุชูุฑุฉ</th>
                    <th>ุนุฏุฏ ุงูููุชุฌุงุช</th>
                    <th>ุฅุฌูุงูู ุงููุงุชูุฑุฉ</th>
                    <th>ุงูุชุงุฑูุฎ ูุงูููุช</th>
                    <th>ุงูุฅุฌุฑุงุกุงุช</th>
                </tr>
            </thead>
            <tbody id="salesHistoryBody"></tbody>
        </table>
        <p>๐ ุฅุฌูุงูู ุงููุจูุนุงุช ุงูููู (ููููุงุชูุฑ ุงููุนุฑูุถุฉ): <span id="totalSalesAmount">0</span> ุฏุฌ</p>
    </div>
  </section>

  <div id="confirmSaleModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal()">&times;</span>
      <h3>ุชุฃููุฏ ุนูููุฉ ุงูุจูุน</h3>
      <p>ูู ุฃูุช ูุชุฃูุฏ ูู ุฅุชูุงู ูุฐุง ุงูุจูุนุ</p>
      <p>ุงููุฌููุน ุงูููู: <strong id="modalCartTotal">0</strong> ุฏุฌ</p>
      <h4>ุชูุงุตูู ุงูุณูุฉ:</h4>
      <ul id="modalCartItems">
        </ul>
      <div class="modal-buttons">
        <button class="confirm-sale-btn" onclick="executeSale()">ุชุฃููุฏ</button>
        <button class="cancel-modal-btn" onclick="closeModal()">ุฅูุบุงุก</button>
      </div>
    </div>
  </div>

  <div id="editProductModal" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close-button" onclick="closeModal()">&times;</span>
      <h3>ุชุนุฏูู ุงูููุชุฌ</h3>
      <input type="hidden" id="editProductOriginalCode">
      <label for="editProductCode">ููุฏ ุงูููุชุฌ:</label>
      <input type="text" id="editProductCode" placeholder="ููุฏ ุงูููุชุฌ" readonly>
      <label for="editProductName">ุงุณู ุงูููุชุฌ:</label>
      <input type="text" id="editProductName" placeholder="ุงุณู ุงูููุชุฌ">
      <label for="editProductCategory">ุงููุฆุฉ:</label>
      <input type="text" id="editProductCategory" placeholder="ุงููุฆุฉ">
      <label for="editProductQty">ุงููููุฉ:</label>
      <input type="number" id="editProductQty" placeholder="ุงููููุฉ">
      <label for="editProductPrice">ุงูุณุนุฑ:</label>
      <input type="number" id="editProductPrice" placeholder="ุงูุณุนุฑ">
      <div class="modal-buttons">
        <button class="confirm-btn" onclick="saveEditedProduct()">ุญูุธ ุงูุชุนุฏููุงุช</button>
        <button class="cancel-btn" onclick="closeModal()">ุฅูุบุงุก</button>
      </div>
    </div>
  </div>

  <div id="invoicePrintModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px; text-align: right;">
        <span class="close-button" onclick="closeModal()">&times;</span>
        <div id="invoiceContent" style="padding: 20px; border: 1px solid #eee; background-color: white; color: black;">
            <h2 style="text-align: center; margin-bottom: 20px; color: #ff7300;">ูุงุชูุฑุฉ ุงูุจูุน</h2>
            <p style="text-align: right;"><strong>ุฑูู ุงููุงุชูุฑุฉ:</strong> <span id="printInvoiceId"></span></p>
            <p style="text-align: right;"><strong>ุงูุชุงุฑูุฎ ูุงูููุช:</strong> <span id="printInvoiceDate"></span></p>
            <hr style="border-top: 1px dashed #ccc; margin: 15px 0;">
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                <thead>
                    <tr style="background-color: #f2f2f2;">
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: right;">ุงูููุชุฌ</th>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: right;">ุงููููุฉ</th>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: right;">ุงูุณุนุฑ (ูููุงุญุฏุฉ)</th>
                        <th style="padding: 8px; border: 1px solid #ddd; text-align: right;">ุงูุฅุฌูุงูู</th>
                    </tr>
                </thead>
                <tbody id="printInvoiceItems">
                </tbody>
            </table>
            <p style="text-align: left; font-size: 1.2em; font-weight: bold; padding-top: 10px; border-top: 2px solid #ff7300;">
                ุงูุฅุฌูุงูู ุงูููู: <span id="printInvoiceTotal"></span> ุฏุฌ
            </p>
            <p style="text-align: center; margin-top: 30px; font-size: 0.9em; color: #555;">ุดูุฑุงู ูุชุนุงููู ูุนูุง!</p>
        </div>
        <div class="modal-buttons" style="margin-top: 20px;">
            <button class="confirm-btn" onclick="printInvoice()">๐จ๏ธ ุทุจุงุนุฉ ุงููุงุชูุฑุฉ</button>
        </div>
    </div>
  </div>

  <div class="notification-container"></div>

  <div class="dark-mode-toggle" onclick="toggleDarkMode()">
      โ๏ธ
  </div>

  <script src="script.js"></script>
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('service-worker.js')
        .then(function(registration) {
          console.log('ServiceWorker registered:', registration.scope);
        }, function(error) {
          console.log('ServiceWorker registration failed:', error);
        });
    });
  }
</script>

</body>
</html>
