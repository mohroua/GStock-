let products = [];let sales = [];let cart = [];let productScanner = null;function showSection(id){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');}function saveData(){localStorage.setItem("products",JSON.stringify(products));localStorage.setItem("sales",JSON.stringify(sales));}function loadData(){const p=localStorage.getItem("products");const s=localStorage.getItem("sales");if(p)products=JSON.parse(p);if(s)sales=JSON.parse(s);updateProductTable();}function generateBarcode(){const now=new Date();return 'P'+now.getFullYear().toString().slice(2)+(now.getMonth()+1).toString().padStart(2,'0')+now.getDate().toString().padStart(2,'0')+now.getHours().toString().padStart(2,'0')+now.getMinutes().toString().padStart(2,'0')+now.getSeconds().toString().padStart(2,'0');}function addProduct(){let code=document.getElementById("productCode").value.trim();const name=document.getElementById("productName").value.trim();const qty=parseInt(document.getElementById("productQty").value);const price=parseFloat(document.getElementById("productPrice").value);if(!name||isNaN(qty)||isNaN(price))return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");if(!code)code=generateBarcode();products.push({code,name,qty,price});updateProductTable();saveData();}function updateProductTable(){const table=document.getElementById("productTable");table.innerHTML="";products.forEach((p,i)=>{table.innerHTML+=`<tr><td>${p.code}</td><td>${p.name}</td><td>${p.qty}</td><td>${p.price}</td><td><svg id="barcode-${i}"></svg></td><td><button onclick="deleteProduct(${i})">ğŸ—‘ï¸</button></td></tr>`;setTimeout(()=>{JsBarcode(`#barcode-${i}`,p.code,{format:"CODE128",width:1.8,height:40,displayValue:false});},50);});}function deleteProduct(i){if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")){products.splice(i,1);updateProductTable();saveData();}}function addToCart(){const code=document.getElementById("saleCode").value.trim();const qty=parseInt(document.getElementById("saleQty").value);if(!code||isNaN(qty))return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©");const product=products.find(p=>p.code===code);if(!product)return alert("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");if(product.qty<qty)return alert("Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©");cart.push({name:product.name,qty,price:product.price,total:qty*product.price});updateCart();}function updateCart(){const table=document.getElementById("cartTable");const totalSpan=document.getElementById("cartTotal");table.innerHTML="";let total=0;cart.forEach((item,i)=>{table.innerHTML+=`<tr><td>${item.name}</td><td>${item.qty}</td><td>${item.price}</td><td>${item.total}</td><td><button onclick="removeFromCart(${i})">ğŸ—‘ï¸</button></td></tr>`;total+=item.total;});totalSpan.textContent=total.toFixed(2);}function removeFromCart(i){cart.splice(i,1);updateCart();}function confirmSale(){if(cart.length===0)return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");cart.forEach(item=>{const p=products.find(p=>p.name===item.name);if(p){p.qty-=item.qty;sales.push({name:item.name,qty:item.qty,date:new Date().toLocaleDateString()});}});cart=[];updateCart();updateProductTable();saveData();alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ¹");}function showInventory(){const list=document.getElementById("inventoryList");list.innerHTML="";products.forEach(p=>{list.innerHTML+=`<li>${p.name} (ÙƒÙˆØ¯: ${p.code}): ${p.qty} ÙˆØ­Ø¯Ø©</li>`;});}function startScanner(){const html5QrCode=new Html5Qrcode("reader");html5QrCode.start({facingMode:"environment"},{fps:10,qrbox:250},(text)=>{document.getElementById("saleCode").value=text;html5QrCode.stop();},(err)=>{}).catch(err=>alert("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§"));}function startProductScanner(){if(productScanner)productScanner.stop();productScanner=new Html5Qrcode("productReader");productScanner.start({facingMode:"environment"},{fps:10,qrbox:250},(text)=>{document.getElementById("productCode").value=text;productScanner.stop();},(err)=>{}).catch(err=>alert("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§"));}loadData();
